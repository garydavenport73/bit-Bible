<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0"
    />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <h1>bitBible</h1>
    <nav id="top-nav">
      <button class="nav-button" id="btn-reading">Plan</button>
      <button class="nav-button" id="btn-bible">Bible</button>
      <button class="nav-button" id="btn-dictionary">Dict</button>
      <button class="nav-button" id="btn-map">Map</button>
    </nav>
    <main>
      <div class="app" id="app-reading">
        <nav>
          <button onclick="loadReadingProgress();">Load Progress</button>
          <button onclick="saveReadingProgress();">Save Progress</button>
          <button onclick="toggleReadingDates();">Show Dates</button>
        </nav>
        <table id="reading-plan-table"></table>
      </div>
      <div class="app" id="app-bible">
        <input
          id="chapter-search-box"
          type="search"
          list="bible-chapters-datalist"
          placeholder="Bible Chapters"
          value="Gen.1"
        />
        <datalist id="bible-chapters-datalist"> </datalist>

        <button onclick="showBibleSelection();">Show</button>
        <div id="bible-result">LOADING...</div>
      </div>
      <div class="app" id="app-dictionary">
        <input
          id="dictionary-search-box"
          type="search"
          list="dictionary-words"
          placeholder="dictionary words"
          value="Jesus"
        />
        <datalist id="dictionary-words"> </datalist>
        <button onclick="showDictionarySelection();">Show</button>
        <div id="dictionary-result">LOADING...</div>
      </div>
      <div class="app" id="app-map">
        <nav>
          <button>OT</button>
          <button>NT</button>
          <button onclick="clearBullsEyes()">Clear</button>
          <button onclick="openGoogleMap()">Google Maps</button>
        </nav>
        <span id="coordinates-label"></span>&nbsp;<span
          id="map-location"
        ></span>
        <div id="map-container"><pre id="ascii-map"></pre></div>
      </div>
    </main>

    <script>
      ///////////// INITIALIZE /////////////////////

      function askConfirm() {
        return "Close?";
      }
      /////////////////// RELATED TO LOADING SAVING READING SCHEDULE /////////////////////

      function saveReadingProgress() {
        let saveData = {};
        for (let i = 1; i < 366; i++) {
          let checkBoxId = "reading-check-" + i.toString();
          if ((checkBox = document.getElementById(checkBoxId) != null)) {
            let checkBox = document.getElementById(checkBoxId);
            console.log(checkBoxId, checkBox.checked);
            saveData[checkBoxId] = checkBox.checked;
          }
        }
        saveData["show-dates"] = showDates;
        console.log(JSON.stringify(saveData));
        saveStringToTextFile(JSON.stringify(saveData));
      }
      function saveStringToTextFile(
        str1,
        basename = "readingPlanProgress",
        fileType = ".json"
      ) {
        let filename = basename + fileType;
        let blobVersionOfText = new Blob([str1], {
          type: "text/plain",
        });
        let urlToBlob = window.URL.createObjectURL(blobVersionOfText);
        let downloadLink = document.createElement("a");
        downloadLink.style.display = "none";
        downloadLink.download = filename;
        downloadLink.href = urlToBlob;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        downloadLink.parentElement.removeChild(downloadLink);
      }

      function loadReadingProgress() {
        let fileContents = "";
        let inputTypeIsFile = document.createElement("input");
        inputTypeIsFile.type = "file";
        inputTypeIsFile.addEventListener("change", function () {
          let fileInput = inputTypeIsFile.files[0];
          let fileReader = new FileReader();
          fileReader.onload = function (fileLoadedEvent) {
            readingPlanData = JSON.parse(fileLoadedEvent.target.result);
            console.log(readingPlanData);
            for (readingDay in readingPlanData) {
              let checkBoxId = readingDay;
              if (document.getElementById(checkBoxId) != undefined) {
                document.getElementById(checkBoxId).checked =
                  readingPlanData[readingDay];
              }
            }
            if (readingPlanData["show-dates"] != undefined) {
              console.log(
                "not undefined, show-dates is " +
                  readingPlanData["show-dates"] +
                  "in json loaded in"
              );

              showDates = readingPlanData["show-dates"];

              if (showDates === true) {
                showReadingDates();
              } else {
                console.log("calling hideReadingDates");
                hideReadingDates();
              }
            }
          };
          fileReader.readAsText(fileInput, "UTF-8");
        });
        inputTypeIsFile.click();
      }
    </script>

    <script>
      //////////////////////////////////////////////////////////////
      //
      //  PROCESSING APP SELECTIONS, ATTACHING EVENTS TO BUTTONS
      //
      //////////////////////////////////////////////////////////////

      function initializeNavButtonsAndCloseApps() {
        let navButtons = document.getElementsByClassName("nav-button");
        for (let i = 0; i < navButtons.length; i++) {
          navButtons[i].addEventListener("click", (evt) => {
            processAppSelection(evt.target.id);
          });
        }
        let apps = document.getElementsByClassName("app");
        for (let i = 0; i < apps.length; i++) {
          apps[i].style.display = "none";
        }
      }

      function processAppSelection(id) {
        let myWidth =
          window.innerWidth ||
          document.documentElement.clientWidth ||
          document.body.clientWidth;
        console.log(myWidth);
        let appId = "app-" + id.split("btn-").join("");
        if (myWidth > 450) {
          let app = document.getElementById(appId);
          //console.log(app.style.display.toString());
          if (app.style.display === "none") {
            app.style.display = "block";
            document.getElementById(id).style.backgroundColor = "green";
          } else {
            app.style.display = "none";
            document.getElementById(id).style.backgroundColor = "lightgrey";
          }
        } else {
          closeAllApps();
          let app = document.getElementById(appId);
          app.style.display = "block";
          document.getElementById(id).style.backgroundColor = "green";
        }
        if (appId === "app-map") {
          setSizeOfPre();
        }
      }

      function closeAllApps() {
        let apps = document.getElementsByClassName("app");
        let appButtons = document.getElementsByClassName("nav-button");
        for (let i = 0; i < apps.length; i++) {
          apps[i].style.display = "none";
        }
        for (let i = 0; i < appButtons.length; i++) {
          appButtons[i].style.backgroundColor = "lightgrey";
        }
      }
      ////////////////////// SECTION ENDS /////////////////////////
    </script>

    <!--//////////////////////////////////////////////////////////////// // //
    READING IN ARRAYS, KEY/VALUES/BIBLE/READINGPLAN/EASTONS/MAP //
    ////////////////////////////////////////////////////////////////-->

    <script src="bookChapterKeys.js"></script>
    <script src="osisReferencesArray.js"></script>
    <script src="NASBChapterBible.js"></script>
    <script src="chronologicalReadingPlan.js"></script>
    <script src="finalDatabase.js"></script>
    <script src="baseMap.js"></script>

    <script>
      //////////////////////////////////////////////////////////////
      //
      //  MAKE READING PLAN TABLE AND NECESSARY FUNCTIONS
      //
      //////////////////////////////////////////////////////////////
      function makeReadingTable(readingPlan) {
        console.log(readingPlan);
        let readingTable = "<tr>";
        let now = new Date();
        let currentYear = now.getFullYear();
        for (let day in readingPlan) {
          let intDay = parseInt(day.split("Day").join("").trim());
          console.log(intDay);
          console.log(day, readingPlan[day]);
          let dayArray = readingPlan[day].split(",");
          readingTable +=
            "<td><ul><input type='checkbox' id='reading-check-" +
            intDay.toString() +
            "'><label><b>" +
            intDay.toString() +
            "</b></label></li>";
          readingTable +=
            "<li class='day-of-year' style='display:none'>" +
            getDateString(currentYear, intDay) +
            "</li>";

          for (readingChapter of dayArray) {
            readingTable +=
              "<li class='open-chapter color-hover'>" +
              readingChapter +
              "</li>";
          }
          readingTable += "</ul></td>";
          if (intDay % 7 === 0) {
            console.log("break week here");
            readingTable += "</tr><tr>";
          }
          if (intDay % 28 === 0) {
            console.log("break month here");
            readingTable +=
              "<td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr>";
          }
        }
        readingTable += "</tr>";
        return readingTable;
      }

      function getTodaysDate() {
        let now = new Date();
        let day = ("0" + now.getDate()).slice(-2);
        let month = ("0" + (now.getMonth() + 1)).slice(-2);
        let today = now.getFullYear() + "-" + month + "-" + day;
        return today;
      }

      function getDateString(year, dayInteger) {
        const d = new Date(year, 0, dayInteger);
        return (
          d.getFullYear().toString() +
          "-" +
          ("0" + (d.getMonth() + 1).toString()).slice(-2) +
          "-" +
          ("0" + d.getDate().toString()).slice(-2)
        );
      }

      function toggleReadingDates() {
        let readingDates = document.getElementsByClassName("day-of-year");
        console.log(readingDates);
        let today = getTodaysDate();

        for (let i = 0; i < readingDates.length; i++) {
          if (readingDates[i].style.display === "none") {
            readingDates[i].style.display = "list-item";
            if (readingDates[i].innerText === today) {
              //console.log("today found! at", today);
              readingDates[i].style.backgroundColor = "orange";
            }
            showDates = true;
          } else {
            readingDates[i].style.display = "none";
            showDates = false;
          }
        }
      }

      function showReadingDates() {
        let today = getTodaysDate();
        let readingDates = document.getElementsByClassName("day-of-year");
        for (let i = 0; i < readingDates.length; i++) {
          readingDates[i].style.display = "list-item";
          if (readingDates[i].innerText === today) {
            //console.log("today found! at", today);
            readingDates[i].style.backgroundColor = "orange";
          }
        }
        showDates = true;
      }
      function hideReadingDates() {
        let readingDates = document.getElementsByClassName("day-of-year");
        for (let i = 0; i < readingDates.length; i++) {
          readingDates[i].style.display = "none";
        }
        showDates = false;
      }

      //////////////////////////////////////////////////////////////
      //
      //                SECTION ENDS
      //
      //////////////////////////////////////////////////////////////
    </script>

    <script>
      ///////PROCESSING BIBLE AND ADDING CLASSES FOR EVENT LISTENERS //////
      /////// IN VERSES, CHAPTERS AND WORDS ///////////////////////
      //////////////// FOR WHOLE BIBLE AT LOAD ///////////////////////

      function makeHTMLChapterBible(theChapterBible) {
        //return theChapterBible;
        let tempStr = JSON.stringify(theChapterBible);
        tempStr = tempStr.split("HEADINGSTART").join("<h2>");
        tempStr = tempStr.split("HEADINGEND").join("</h2>");
        tempStr = tempStr.split("HEADINGEND").join("</h2>");
        tempStr = tempStr.split("PARAGRAPHSTARTS").join("<p>");
        tempStr = tempStr.split("PARAGRAPHENDS").join("</p>");
        tempStr = tempStr.split("VERSESTART").join("<sup>");
        tempStr = tempStr.split("VERSEEND").join("</sup>");
        tempStr = tempStr
          .split("FOUNDWORDSTART")
          .join("<span class='color-hover found-bible-word'>");
        tempStr = tempStr.split("FOUNDWORDEND").join("</span>");
        return JSON.parse(tempStr);
      }

      function makeEastons(eastons) {
        //return eastons;
        let tempStr = JSON.stringify(eastons);
        tempStr = tempStr
          .split("VERSEREFSTART")
          .join("<span class='open-verse color-hover'>");
        tempStr = tempStr.split("VERSEREFEND").join("</span>");
        tempStr = tempStr
          .split("CHAPTERREFSTART")
          .join("<span class='open-chapter color-hover'>");
        tempStr = tempStr.split("CHAPTERREFEND").join("</span>");
        return JSON.parse(tempStr);
      }

      function parseString(str) {
        str = str.split("HEADINGSTART").join("<h2>");
        str = str.split("HEADINGEND").join("</h2>");
        str = str.split("HEADINGEND").join("</h2>");
        str = str.split("PARAGRAPHSTARTS").join("<p>");
        str = str.split("PARAGRAPHENDS").join("</p>");
        str = str.split("VERSESTART").join("<sup>");
        str = str.split("VERSEEND").join("</sup>");
        str = str
          .split("FOUNDWORDSTART")
          .join("<span class='color-hover found-bible-word'>");
        str = str.split("FOUNDWORDEND").join("</span>");
        str = str
          .split("VERSEREFSTART")
          .join("<span class='open-verse color-hover'>");
        str = str.split("VERSEREFEND").join("</span>");
        str = str
          .split("CHAPTERREFSTART")
          .join("<span class='open-chapter color-hover'>");
        str = str.split("CHAPTERREFEND").join("</span>");
        return str;
      }

      ////////////////////////////////////////////////////////////////
    </script>

    <script>
      ///////////////POPULATING THE SELECT OPTIONS OF THE BIBLE CHAPTER SELECTIONS //////////////////
      function populateChapterSelectElement() {
        //bookChapterKeys global bibleBCSelction also global
        let str = "";
        for (let i = 0; i < bookChapterKeys.length; i++) {
          str += "<option value='" + bookChapterKeys[i] + "' />";
        }
        bibleChaptersDatalist.innerHTML = str;
      }

      /////// TAKES CURRENT BIBLE SELECTION AND LOADS THE BIBLE PASSAGE
      /////// THEN ATTACHES EVENT LISTENERS TO SPANS OF FOUND WORDS
      function showBibleSelection() {
        //***************** AJAX function ********************
        bibleResult.innerHTML = parseString(
          theChapterBible[chapterSearchBox.value]
        );
        addEventListenersToFoundBibleWords();
      }

      /////// GIVEN CHAPTER REFERENCE SET THE CHAPTER SEARCH BOX TO REFERENCE
      /////// ADD EVENT LISTENERS TO THE BIBLE CHAPTER AFTER LOADING
      function selectBibleChapter(osisRef) {
        chapterSearchBox.value = osisRef;
        showBibleSelection();
        addEventListenersToFoundBibleWords();
        let myWidth =
          window.innerWidth ||
          document.documentElement.clientWidth ||
          document.body.clientWidth;
        if (myWidth < 450) {
          processAppSelection("btn-bible");
        }
      }

      ////// SIMPLY PARSES FULL BIBLE VERSE TO CHAPTER 0NLY AND CALLS
      ////// selectBibleChapter
      function selectBibleVerse(osisRef) {
        osisRefArray = osisRef.split(".");
        osisRefArray.pop();
        osisRef = osisRefArray.join(".");
        selectBibleChapter(osisRef);
      }

      /////// FUNCTIONS TO ADD EVENT LISTENERS TO VERSES, CHAPTERS, DICTIONARY
      /////// AND LOCATION SPANS

      function addEventListenersToOpenVerses() {
        let openVerses = document.getElementsByClassName("open-verse");
        for (let i = 0; i < openVerses.length; i++) {
          openVerses[i].addEventListener("click", (evt) => {
            selectBibleVerse(evt.target.innerText);
          });
        }
      }

      function addEventListenersToOpenChapters() {
        let openChapters = document.getElementsByClassName("open-chapter");
        for (let i = 0; i < openChapters.length; i++) {
          openChapters[i].addEventListener("click", (evt) => {
            selectBibleChapter(evt.target.innerText);
          });
        }
      }

      function addEventListenersToOpenDictionaryEntries() {
        //doesn't use word, but uses subentry under word
        let openDictionaryEntries = document.getElementsByClassName(
          "open-dictionary-entry"
        );
        for (let i = 0; i < openDictionaryEntries.length; i++) {
          openDictionaryEntries[i].addEventListener("click", (evt) => {
            openDictionaryEntry(
              getWordFromEntry(evt.target.innerText),
              evt.target.innerText
            );
          });
        }
      }

      function getWordFromEntry(dictLookup) {
        //************* NEEDS A PREPROCESSED ARRAY HERE OR SIMPLY TEST AND SPLICE ********************
        let tempArr = dictLookup.split(" ");
        if (tempArr[tempArr.length - 1] === NaN) {
          console.log("word ", dictLookup);
          return dictLookup;
        } else {
          tempArr.pop();
          console.log("word", tempArr.join(" "));
          return tempArr.join(" ");
        }
      }

      function addEventListenersToFoundBibleWords() {
        let foundBibleWords =
          document.getElementsByClassName("found-bible-word");
        for (let i = 0; i < foundBibleWords.length; i++) {
          foundBibleWords[i].addEventListener("click", (evt) => {
            openDictionaryEntry(
              evt.target.innerText,
              getBestDefinitionEntry(evt.target.innerText) //return undefined if none found
            );
          });
        }
      }

      function addEventListenersToDictionaryLocations() {
        let dictionaryLocations = document.getElementsByClassName(
          "dictionary-location"
        );
        for (let i = 0; i < dictionaryLocations.length; i++) {
          dictionaryLocations[i].addEventListener("click", (evt) => {
            let myWidth =
              window.innerWidth ||
              document.documentElement.clientWidth ||
              document.body.clientWidth;
            if (myWidth < 450) {
              //document.getElementById('btn-map').click();
              processAppSelection("btn-map");
            } else {
              document.getElementById("app-map").style.display = "block";
              document.getElementById("btn-map").style.backgroundColor =
                "green";
            }
            setSizeOfPre();
            document.getElementById("map-location").innerHTML =
              evt.target.innerText;
            document.getElementById("coordinates-label").innerHTML =
              dictionarySearchBox.value;
            plotOnMap(evt.target.innerText);
          });
        }
      }

      function openGoogleMap() {
        let location = document.getElementById("map-location").innerText;
        window.open("http://maps.google.com/maps?q=" + location);
      }

      function plotOnMap(location) {
        if (document.getElementById("app-map").style.display === "none") {
          //do nothing
        } else {
          let labelText = dictionarySearchBox.value;

          let latitude = parseFloat(location.split(",")[0]);
          let longitude = parseFloat(location.split(",")[1]);
          let x = convertLongitude(longitude);
          let y = convertLatitude(latitude);
          console.log(latitude, longitude);
          console.log(x, y);

          let bullsEye = document.createElement("span");
          bullsEye.classList.add("bulls-eye");
          bullsEye.style.position = "absolute";
          bullsEye.style.left = x.toString() + "px";
          bullsEye.style.top = y.toString() + "px";
          //bullsEye.innerHTML="o<span class='bulls-eye-extra-label'>yooyoyoyoyoyoyoyo</span>";
          bullsEye.innerHTML = "o";

          bullsEyeLabel = document.createElement("span");
          bullsEyeLabel.classList.add("bulls-eye-label");
          bullsEyeLabel.style.position = "absolute";
          bullsEyeLabel.style.left = (x + 10).toString() + "px";
          bullsEyeLabel.style.top = y.toString() + "px";
          bullsEyeLabel.innerHTML = labelText;

          mapContainer.appendChild(bullsEye);
          mapContainer.appendChild(bullsEyeLabel);
        }
      }

      function convertLongitude(longitude) {
        //the map is about 320px wide //get computed width
        //longitude starts at 33.5 and ends at 36.5
        //let width=320;
        //width=parseFloat(asciiMap.width.slice(0,-2));
        let width = asciiMap.offsetWidth;
        console.log("calculated sscii map width", width);
        let x = (width * longitude - width * 33.5) / (36.5 - 33.5);
        console.log(x);
        return x;
      }

      function convertLatitude(latitude) {
        //the map is about 620px high
        //latitude starts at 34 and goes to 29
        //let height=620;
        //height=parseFloat(asciiMap.height.slice(0,-2));
        let height = asciiMap.offsetHeight;
        console.log("calculated ascii map height", height);
        let slope = height / (29 - 34);
        let y = slope * latitude - slope * 34;
        console.log(y);
        return y;
      }

      function clearBullsEyes() {
        let bullsEyes = document.getElementsByClassName("bulls-eye");
        let bullsEyeLabels = document.getElementsByClassName("bulls-eye-label");

        for (let i = bullsEyes.length - 1; i >= 0; i--) {
          bullsEyes[i].remove();
        }

        for (let i = bullsEyeLabels.length - 1; i >= 0; i--) {
          bullsEyeLabels[i].remove();
        }

        document.getElementById("map-location").innerHTML = "";
        document.getElementById("coordinates-label").innerHTML = "";
      }

      function setSizeOfPre() {
        asciiMap.style.fontSize = "20px";
        let floatFontSize = 20;
        let pixelWidth = 320; //target width
        console.log(asciiMap.offsetWidth); //the width of ascii map
        while (asciiMap.offsetWidth >= pixelWidth) {
          //map to big, above target
          floatFontSize = parseFloat(asciiMap.style.fontSize.slice(0, -2));
          console.log(asciiMap.offsetWidth, floatFontSize);
          floatFontSize = floatFontSize - 0.5;
          asciiMap.style.fontSize = floatFontSize + "px"; //reduce map font size
          if (floatFontSize <= 0.5) {
            //minimum font size;
            break;
          }
        }
      }

      addEventListenersToOpenVerses();
      addEventListenersToOpenChapters();
      addEventListenersToOpenDictionaryEntries();
      addEventListenersToFoundBibleWords();
      addEventListenersToDictionaryLocations();
    </script>
    <!--DICTIONARY STUFF HERE-->

    <script>
      /////////////////////////////////////////////////////////////////////
      //
      /////////////////// DICTIONARY ENTRY OPENING ETC ////////////////////
      //
      ///////////////////////////////////////////////////////////////////

      function populateDictionarySelection() {
        //***************** NEEDS EASTONS WORD INDEX ARRAY ********************
        let str = "";
        for (let i = 0; i < eastons.length; i++) {
          str += "<option value='" + eastons[i]["word"] + "' />";
        }
        dictionaryDataList.innerHTML = str;
      }

      ////////////////////////////////////////////
      //    HANDLING THE OPENING OF A WORD AND ENTRY
      //
      function openDictionaryEntry(word, entry) {
        //opens the word in dictionary and subentry if given
        //_selectDictionaryWord(word); //setting the index correctly in the select element
        word = word.charAt(0).toUpperCase() + word.slice(1); //capitalizes first letter
        dictionarySearchBox.value = word;
        showDictionarySelection(); //builds the dictionary innerHTML content and adds event listeners
        //takes the word not subword from the selection element
        //note will be closed unless there is only one definition then it is opened

        console.log(entry);
        if (entry != undefined) {
          openSiblings(entry);
        }
        ////FORCE APP TO EVALUATE OPENING OR CLOSING WINDOWS IF SMALL SCREEN
        let myWidth =
          window.innerWidth ||
          document.documentElement.clientWidth ||
          document.body.clientWidth;
        if (myWidth < 450) {
          //document.getElementById('btn-dictionary').click();
          processAppSelection("btn-dictionary");
        }
      }

      function showDictionarySelection() {
        //let selectedWord = dictionarySelection.options[dictionarySelection.selectedIndex].text;
        let word = dictionarySearchBox.value;
        word = word.charAt(0).toUpperCase() + word.slice(1); //capitalizes first letter
        let selectedWord = word;

        let resultEntries = getEntries(selectedWord);
        if (resultEntries != undefined) {
          //loop through entries
          let str = "";
          for (let i = 0; i < resultEntries.length; i++) {
            str += "<hr>";
            //loopp through keys
            str += "<div>";
            for (const key in resultEntries[i]) {
              //handle every key type lookup here
              //dictLookup
              //dictText
              //verseReferences
              //location
              //mother
              //father
              //partners
              //children
              //siblings
              //halfSiblingsSameMother
              //halfSiblingsSameFather
              if (key === "dictLookup") {
                let id = resultEntries[i][key];
                str +=
                  "<h3 class='nested-menu word-entry color-hover' id='" +
                  id +
                  "'>" +
                  resultEntries[i][key] +
                  "</h3>";
              }
              //handl
              else if (key == "dictText") {
                str += "<h3>Text:</h3>";
                str += "<p>";
                str += resultEntries[i][key];
                str += "</p>";
                //str += "<h3>" + key + "</h3>";
                //str += "<p>";
                //str += resultEntries[i][key];
                //str += "</p>";
              } else if (key == "verseReferences") {
                str += "<h3>References:</h3>";
                str += "<p>";

                //let versesArray=resultEntries[i][key].split(",");
                //str+="<span class='open-verse color-hover'>";
                //str+=resultEntries[i][key].split(",").join("</span>,<span class='open-verse color-hover'>");
                //str+="</span>";
                str += resultEntries[i][key];

                str += "</p>";
              } else if (
                key === "mother" ||
                key === "father" ||
                key === "partners" ||
                key === "children" ||
                key === "siblings" ||
                key === "halfSiblingsSameMother" ||
                key === "halfSiblingsSameFather"
              ) {
                if (key === "mother") {
                  str += "<h3>Mother:</h3>";
                } else if (key === "father") {
                  str += "<h3>Father:</h3>";
                } else if (key === "partners") {
                  str += "<h3>Partner:</h3>";
                } else if (key === "children") {
                  str += "<h3>Children:</h3>";
                } else if (key === "siblings") {
                  str += "<h3>Siblings:</h3>";
                } else if (key === "halfSiblingsSameMother") {
                  str += "<h3>Half-Sibling (same mother):</h3>";
                } else if (key === "halfSiblingsSameFather") {
                  str += "<h3>Half-Sibling (same father):</h3>";
                }

                //mother
                //father
                //partners
                //children
                //siblings
                //halfSiblingsSameMother
                //halfSiblingsSameFather

                str += "<p>";
                let peopleArray = resultEntries[i][key].split(",");

                for (let j = 0; j < peopleArray.length; j++) {
                  if (peopleArray[j].indexOf("no entry") == -1) {
                    //no entry in dictionary
                    str += "<span class='open-dictionary-entry color-hover'>";
                    str += peopleArray[j];
                    str += "</span>,";
                  } else {
                    //entry in dictionary
                    str += "<span>";
                    str += peopleArray[j];
                    str += "</span>,";
                  }
                }
                str = str.slice(0, -1);

                str += "</p>";
              } else if (key === "location") {
                str += "<h3>Location:</h3>";
                str += "<p>";
                str +=
                  "<span class='dictionary-location color-hover'>" +
                  resultEntries[i][key] +
                  "</span>";
                str += "</p>";
              } else {
                str += "<h3>" + key + "</h3>";
                str += "<p>";
                str += resultEntries[i][key];
                str += "</p>";
              }
            }
            str += "</div>";
          }
          str += "<hr>";

          dictionaryResult.innerHTML = str;
          //console.log(resultEntries);
          addEventListenersToNestedMenus();
          addEventListenersToOpenVerses();
          addEventListenersToOpenChapters();
          addEventListenersToOpenDictionaryEntries();
          addEventListenersToDictionaryLocations();
          //if there is just one leave open
          if (resultEntries.length > 1) {
            closeWordEntries();
          }
        } else {
          dictionaryResult.innerHTML = "<h3>Word not found</h3>";
        }
      }

      function closeWordEntries() {
        let wordEntries = document.getElementsByClassName("word-entry");
        for (let i = 0; i < wordEntries.length; i++) {
          closeSiblings(wordEntries[i].id);
        }
      }

      function getEntries(soughtWord) {
        //     ///*************Ajax call here ******************
        let index = getIndexOfWord(soughtWord);

        return JSON.parse(
          parseString(JSON.stringify(eastons[index]["entries"]))
        );

        //return JSON.parse(JSON.stringify(parseAllText(eastons[index]["entries"])));
      }

      function getBestDefinitionEntry(word) {
        //uses current Bible chapter to see
        //if there is a verse referenced in the deinition, returns the subword
        // if there is a match
        console.log(word);
        word = word.charAt(0).toUpperCase() + word.slice(1); //capitalizes first letter
        // osisChapter =
        //   bibleBCSelection.options[bibleBCSelection.selectedIndex].value;
        let osisChapter = chapterSearchBox.value;

        //find the right index for the word
        index = getIndexOfWord(word);

        //*************Needs ajax Call HERE
        //let entries = parseAllText(eastons[index]["entries"]);
        let entries = JSON.parse(
          parseString(JSON.stringify(eastons[index]["entries"]))
        );
        for (let i = 0; i < entries.length; i++) {
          //if the entry contains the verse, then
          //return the dictlookup of entry
          //console.log(entries[i]["verseReferences"]);
          let verseReferencesArray = entries[i]["verseReferences"].split(",");
          //console.log(verseReferencesArray);
          for (let j = 0; j < verseReferencesArray.length; j++) {
            let compareVerse = verseReferencesArray[j]
              .split("<span class='open-verse color-hover'>")
              .join("")
              .split("</span>")
              .join("");
            let compareChapter =
              compareVerse.split(".")[0] + "." + compareVerse.split(".")[1];
            if (compareChapter === osisChapter) {
              console.log("!!found at ", entries[i]["dictLookup"]);
              return entries[i]["dictLookup"];
            }
          }
        }
        //returns undefined if nothing found
      }

      function getIndexOfWord(word) {
        ////NEEDS ARRAY HERE
        for (let i = 0; i < eastons.length; i++) {
          if (eastons[i]["word"] === word) {
            //console.log("found at",i);
            return i;
          }
        }
        return -1;
      }

      ////////////////////////////////////////////
      ////////// NESTED MENU STUFF ////////////////
      ///////////////////////////////////////
      function toggleNest(menu) {
        let siblings = menu.parentElement.children;
        for (let sibling of siblings) {
          if (sibling === menu) {
            //alert("found self!");
          } else {
            if (sibling.style.display === "none") {
              sibling.style.display = "inherit";
            } else {
              sibling.style.display = "none";
            }
          }
        }
      }

      function addEventListenersToNestedMenus() {
        let nestedMenues = document.getElementsByClassName("nested-menu");
        for (let nestedmenu of nestedMenues) {
          nestedmenu.addEventListener("click", (evt) => {
            toggleNest(evt.target);
          });
        }
      }

      function openSiblings(id) {
        let menu = document.getElementById(id);
        let siblings = menu.parentElement.children;
        for (let sibling of siblings) {
          if (sibling === menu) {
          } else {
            sibling.style.display = "inherit";
          }
        }
      }

      function closeSiblings(id) {
        let menu = document.getElementById(id);
        let siblings = menu.parentElement.children;
        for (let sibling of siblings) {
          if (sibling === menu) {
            //do nothing
          } else {
            sibling.style.display = "none";
          }
        }
      }
      ///////////////////////NESTED MENU STUFF ENDS///////////////
    </script>

    <script>
      initializeNavButtonsAndCloseApps();
      let showDates = true;
      window.onbeforeunload = askConfirm;
      let bibleBCSelection = document.getElementById("bible-bc-selection");
      let bibleResult = document.getElementById("bible-result");
      let mapContainer = document.getElementById("map-container");
      let asciiMap = document.getElementById("ascii-map");
      let dictionarySelection = document.getElementById("dictionary-selection");
      let dictionaryResult = document.getElementById("dictionary-result");
      let dictionaryDataList = document.getElementById("dictionary-words");
      let dictionarySearchBox = document.getElementById(
        "dictionary-search-box"
      );
      let chapterSearchBox = document.getElementById("chapter-search-box");
      let bibleChaptersDatalist = document.getElementById(
        "bible-chapters-datalist"
      );
      populateDictionarySelection();
      populateChapterSelectElement();
      //theChapterBible = makeHTMLChapterBible(theChapterBible);
      //eastons = makeEastons(eastons);
      document.getElementById("reading-plan-table").innerHTML =
        makeReadingTable(readingPlan);
      toggleReadingDates();
      addEventListenersToNestedMenus();
      openDictionaryEntry("Jesus", "Jesus 2");
      selectBibleVerse("John.3.16");
      closeAllApps();
      document.getElementById("app-bible").style.display = "block";
      document.getElementById("btn-bible").style.backgroundColor = "green";
      document.getElementById("ascii-map").innerText = baseMap;
      setSizeOfPre();
    </script>
  </body>
</html>

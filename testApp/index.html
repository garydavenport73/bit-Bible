<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0"
    />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <h1>bitBible<sub id="version-type">online version</sub></h1>
    <nav id="top-nav">
      <button class="nav-button" id="btn-reading">&#128197;</button>
      <button class="nav-button" id="btn-bible">&#128214;</button>
      <button class="nav-button" id="btn-dictionary">&#128216;</button>
      <button class="nav-button" id="btn-commentary">&#128172;</button>
      <button class="nav-button" id="btn-map">&#127757;</button>
      <button class="nav-button" id="btn-download">&#10515;</button>
      <!-- for settings -->
      <!-- <button>&#9881;</button> -->
    </nav>
    <main>
      <div class="app" id="app-reading">
        <h3 id="reading-plan-name">Chronological</h3>
        <nav>
          <button onclick="loadReadingProgress();">
            Load Progress&#128194;
          </button>
          <button onclick="saveReadingProgress();">Save&#128193;</button>
          <button onclick="toggleReadingDates();">&#128260;Dates</button>
        </nav>
        <table id="reading-plan-table"></table>
      </div>

      <div class="app" id="app-download">
        <h3 id="download-name">Download</h3>
        <p>Coming soon ... offline version!</p>
      </div>
      <!-- make bible entries similary to commentary entries -->

      <div class="app" id="app-bible">
        <h3 id="bible-name">NASB</h3>
        <input
          id="chapter-search-box"
          type="search"
          list="bible-chapters-datalist"
          placeholder="Bible Chapters"
          value="Gen.1"
        />
        <datalist id="bible-chapters-datalist"> </datalist>
        <button onclick="showBibleSelection();">Go</button>
        <button onclick="openBibleChapterCommentary()" ;>
          &#8625;&#128172;
        </button>
        <div id="bible-result">LOADING...</div>
      </div>

      <div class="app" id="app-commentary">
        <h3 id="commentary-name">Pulpit Commentary</h3>
        <input
          id="commentary-search-box"
          type="search"
          list="commentary-chapters-datalist"
          placeholder="Bible Chapters"
          value="Gen.1"
        />
        <!-- value="John.3"
        /> -->
        <datalist id="commentary-chapters-datalist"> </datalist>
        <button onclick="showCommentarySelection();">Go</button>
        <div id="commentary-result">
          Type a chapter in the search box to see commentary.
        </div>
      </div>

      <!-- make bible entries similary to commentary entries -->
      <div class="app" id="app-dictionary">
        <h3 id="dictionary-name">Easton's Dictionary</h3>
        <input
          id="dictionary-search-box"
          type="search"
          list="dictionary-words"
          placeholder="dictionary words"
        />
        <!-- value="Jesus"
        /> -->
        <datalist id="dictionary-words"> </datalist>
        <button onclick="showDictionarySelection();">&#128269;</button>
        <div id="dictionary-result">
          Type in the search box to look for words in the Bible Dictionary.
        </div>
      </div>
      <div class="app" id="app-map">
        <nav>
          <!-- &#9398; -->
          <button class="btn-select-map" id="map-Abraham">Ⓐ</button>
          <!-- &#9410; -->
          <button class="btn-select-map" id="map-Moses">Ⓜ</button>
          <!-- &#9323; -->
          <button class="btn-select-map" id="map-12 Tribes">⑫</button>
          <!-- &#10208; -->
          <button class="btn-select-map" id="map-Divided Kingdoms">⟠</button>
          <!-- &#9407; -->
          <button class="btn-select-map" id="map-Jesus">Ⓙ</button>
          <button onclick="clearBullsEyes();clearBackgroundLocations();">
            &#8999;
          </button>
          <button onclick="openGoogleMap()">&#127760;</button>
        </nav>
        <div id="map-name">&nbsp;</div>
        <div>
          <span id="coordinates-label"></span>&nbsp;<span
            id="map-location"
          ></span>
        </div>

        <div id="map-container"><pre id="ascii-map"></pre></div>
      </div>
    </main>
    <!--//////////////////////////////////////////////////////////////// // //
    READING IN ARRAYS, KEY/VALUES/BIBLE/READINGPLAN/EASTONS/MAP //
    ////////////////////////////////////////////////////////////////-->

    <script src="bookChapterKeys.js"></script>
    <script src="osisReferencesArray.js"></script>
    <script src="chronologicalReadingPlan.js"></script>
    <script src="baseMap.js"></script>

    <script>
        function addEventListenersToMapButtons() {
          let mapButtons = document.getElementsByClassName("btn-select-map");
          for (let i = 0; i < mapButtons.length; i++) {
            mapButtons[i].style.backgroundColor = "lightgrey";
            mapButtons[i].addEventListener("click", (evt) => {
              processMapButtonClick(evt.target.id);
            });
          }
        }
        addEventListenersToMapButtons();
  
        function processMapButtonClick(id) {
          let mapButtons = document.getElementsByClassName("btn-select-map");
          for (let i = 0; i < mapButtons.length; i++) {
            mapButtons[i].style.backgroundColor = "lightgrey";
          }
          document.getElementById(id).style.backgroundColor = "rgb(0,124,207)";
          document.getElementById("map-name").innerHTML = id.slice(4);
          plotBackgroundMapLocations(id);
        }
      </script>

    <script>
      function _buildDictionarySearchOptionsRemote() {
        console.log("using remote");
        let http = new XMLHttpRequest();
        http.timeout = 2000; // time in milliseconds
        let url = "getdictionarywordlist.php";
        http.ontimeout = function (e) {
          alert("The request timed out.");
        };
        http.open("POST", url, true);
        http.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        http.onreadystatechange = function () {
          if (http.readyState == 4 && http.status == 200) {
            console.log(http.responseText);
            wordList = JSON.parse(parseString(http.responseText));
            console.log("*****!!!!!!!!!!!!WORD LIST !!!!!!!!!!!!*****");
            console.log(wordList);
            let str = "";
            for (let i = 0; i < wordList.length; i++) {
              str += "<option value='" + wordList[i] + "' />";
            }
            dictionaryDataList.innerHTML = str;
            // openDictionaryEntry("Jesus", "Jesus 2");
          }
        };
        http.send();
      }
    </script>

    <script>
      function openBibleChapterCommentary() {
        commentarySearchBox.value = chapterSearchBox.value;
        showCommentarySelection();
      }

      function getDictionaryWordDataRemote(index, entry) {
        console.log("INDEX", index);
        console.log("using remote defnitions");
        let http = new XMLHttpRequest();
        http.timeout = 2000; // time in milliseconds
        // let email = encodeURIComponent(
        //   document.getElementById("test-form-email").value
        // );
        // let password = encodeURIComponent(
        //   document.getElementById("test-form-password").value
        // );

        //let url = "https://garydavenport.com/logtime/simpleAccounts.php";
        let url = "getdictionaryworddata.php";

        // let params =
        //   "email=" + email + "&password=" + password + "&do-this=test";
        let params = "index=" + index;
        http.ontimeout = function (e) {
          alert("The request timed out.");
        };
        http.open("POST", url, true);
        http.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        http.onreadystatechange = function () {
          if (http.readyState == 4 && http.status == 200) {
            console.log(http.responseText);
            //salert("Response received:\n" + http.responseText);
            {
              let wordData = JSON.parse(parseString(http.responseText));

              let resultEntries = wordData["entries"];

              _buildDictionaryResult(resultEntries, entry);
            }
          }
        };
        http.send(params);
      }

      function _buildDictionaryResult(resultEntries, entry) {
        if (resultEntries != undefined) {
          //loop through entries
          let str = "";
          for (let i = 0; i < resultEntries.length; i++) {
            str += "<hr>";
            //loopp through keys
            str += "<div>";
            for (const key in resultEntries[i]) {
              //handle every key type lookup here
              //dictLookup
              //dictText
              //verseReferences
              //location
              //mother
              //father
              //partners
              //children
              //siblings
              //halfSiblingsSameMother
              //halfSiblingsSameFather
              if (key === "dictLookup") {
                let id = resultEntries[i][key];
                str +=
                  "<h3 class='nested-menu word-entry color-hover' id='" +
                  id +
                  "'>" +
                  resultEntries[i][key] +
                  "</h3>";
              }
              //handl
              else if (key == "dictText") {
                str += "<h3>Text:</h3>";
                str += "<p>";
                str += resultEntries[i][key];
                str += "</p>";
                //str += "<h3>" + key + "</h3>";
                //str += "<p>";
                //str += resultEntries[i][key];
                //str += "</p>";
              } else if (key == "verseReferences") {
                str += "<h3>References:</h3>";
                str += "<p>";

                //let versesArray=resultEntries[i][key].split(",");
                //str+="<span class='open-verse color-hover'>";
                //str+=resultEntries[i][key].split(",").join("</span>,<span class='open-verse color-hover'>");
                //str+="</span>";
                str += resultEntries[i][key];

                str += "</p>";
              } else if (
                key === "mother" ||
                key === "father" ||
                key === "partners" ||
                key === "children" ||
                key === "siblings" ||
                key === "halfSiblingsSameMother" ||
                key === "halfSiblingsSameFather"
              ) {
                if (key === "mother") {
                  str += "<h3>Mother:</h3>";
                } else if (key === "father") {
                  str += "<h3>Father:</h3>";
                } else if (key === "partners") {
                  str += "<h3>Partner:</h3>";
                } else if (key === "children") {
                  str += "<h3>Children:</h3>";
                } else if (key === "siblings") {
                  str += "<h3>Siblings:</h3>";
                } else if (key === "halfSiblingsSameMother") {
                  str += "<h3>Half-Sibling (same mother):</h3>";
                } else if (key === "halfSiblingsSameFather") {
                  str += "<h3>Half-Sibling (same father):</h3>";
                }

                //mother
                //father
                //partners
                //children
                //siblings
                //halfSiblingsSameMother
                //halfSiblingsSameFather

                str += "<p>";
                let peopleArray = resultEntries[i][key].split(",");

                for (let j = 0; j < peopleArray.length; j++) {
                  if (peopleArray[j].indexOf("no entry") == -1) {
                    //no entry in dictionary
                    str += "<span class='open-dictionary-entry color-hover'>";
                    str += peopleArray[j];
                    str += "</span>,";
                  } else {
                    //entry in dictionary
                    str += "<span>";
                    str += peopleArray[j];
                    str += "</span>,";
                  }
                }
                str = str.slice(0, -1);

                str += "</p>";
              } else if (key === "location") {
                str += "<h3>Location:</h3>";
                str += "<p>";
                str +=
                  "<span class='dictionary-location color-hover'>" +
                  resultEntries[i][key] +
                  "</span>";
                str += "</p>";

                // let tempStr="";
                // tempStr += "<h3>Location:</h3>";
                // tempStr += "<p>";
                // tempStr +=
                //   "<span class='dictionary-location color-hover'>" +
                //   resultEntries[i][key] +
                //   "</span>";
                // tempStr += "</p>";
                // str=tempStr+str;
              } else {
                str += "<h3>" + key + "</h3>";
                str += "<p>";
                str += resultEntries[i][key];
                str += "</p>";
              }
            }
            str += "</div>";
          }
          //   str = "<hr>"+str+"<hr>";
          str += "<hr>";

          dictionaryResult.innerHTML = str;
          //console.log(resultEntries);
          addEventListenersToNestedMenus();
          addEventListenersToOpenVerses();
          addEventListenersToOpenChapters();
          addEventListenersToOpenDictionaryEntries();
          addEventListenersToDictionaryLocations();
          //if there is just one leave open
          if (resultEntries.length > 1) {
            closeWordEntries();
          }
        } else {
          dictionaryResult.innerHTML = "<h3>Word not found</h3>";
        }
        //add code here to look for best entry if undefined**************
        //console.log(entry);
        if (entry != undefined) {
          openSiblings(entry);
        } else {
          //get the opened Bible Chapter in the search box
          let osisChapter = chapterSearchBox.value;

          //go through each entry
          for (let i = 0; i < resultEntries.length; i++) {
            let verseReferences = resultEntries[i]["verseReferences"]
              .split("<span class='open-verse color-hover'>")
              .join("")
              .split("</span>")
              .join("")
              .split(",");
            console.log(verseReferences);
            //go through each entries verses
            for (let j = 0; j < verseReferences.length; j++) {
              //it the verse chapter matches the opened bible chapter
              //that is the sibling
              //open that sibling
              //(must take off verse at end to leave only book and chapter)
              console.log(
                osisChapter,
                verseReferences[j].split(".")[0] +
                  "." +
                  verseReferences[j].split(".")[1]
              );
              if (
                osisChapter ===
                verseReferences[j].split(".")[0] +
                  "." +
                  verseReferences[j].split(".")[1]
              ) {
                console.log("match found", resultEntries[i]);
                openSiblings(resultEntries[i]["dictLookup"]);
              }
            }
          }
        }
        ////FORCE APP TO EVALUATE OPENING OR CLOSING WINDOWS IF SMALL SCREEN
        let myWidth =
          window.innerWidth ||
          document.documentElement.clientWidth ||
          document.body.clientWidth;
        if (myWidth < 450) {
          //document.getElementById('btn-dictionary').click();
          processAppSelection("btn-dictionary");
        }
      }
      //getDictionaryWordDataRemote(0);

      function getBibleChapterRemote(osisRef) {
        let http = new XMLHttpRequest();
        http.timeout = 2000; // time in milliseconds
        //let url = "https://garydavenport.com/logtime/simpleAccounts.php";
        let url = "getchapter.php";
        // let params =
        //   "email=" + email + "&password=" + password + "&do-this=test";
        let params = "osisRef=" + osisRef;
        http.ontimeout = function (e) {
          alert("The request timed out.");
        };
        http.open("POST", url, true);
        http.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        http.onreadystatechange = function () {
          if (http.readyState == 4 && http.status == 200) {
            console.log(http.responseText);
            //alert("Response received:\n" + http.responseText);

            bibleResult.innerHTML = parseString(http.responseText);
            addEventListenersToFoundBibleWords();
            let myWidth =
              window.innerWidth ||
              document.documentElement.clientWidth ||
              document.body.clientWidth;
            if (myWidth < 450) {
              processAppSelection("btn-bible");
            }
          }
        };
        http.send(params);
      }

      function getCommentaryChapterRemote(osisRef) {
        let http = new XMLHttpRequest();
        http.timeout = 2000; // time in milliseconds
        //let url = "https://garydavenport.com/logtime/simpleAccounts.php";
        let url = "getcommentarychapter.php";
        // let params =
        //   "email=" + email + "&password=" + password + "&do-this=test";
        let params = "osisRef=" + osisRef;
        http.ontimeout = function (e) {
          alert("The request timed out.");
        };
        http.open("POST", url, true);
        http.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        http.onreadystatechange = function () {
          if (http.readyState == 4 && http.status == 200) {
            console.log(http.responseText);
            //alert("Response received:\n" + http.responseText);

            commentaryResult.innerHTML = parseString(http.responseText);
            addEventListenersToOpenVerses();
            //addEventListenersToFoundBibleWords(); not yet needed add later when working
            let myWidth =
              window.innerWidth ||
              document.documentElement.clientWidth ||
              document.body.clientWidth;
            if (myWidth < 450) {
              processAppSelection("btn-commentary");
            }
          }
        };
        http.send(params);
      }
      //getBibleChapterRemote("Gen.1");
      ///////////// INITIALIZE /////////////////////

      function askConfirm() {
        return "Close?";
      }
      /////////////////// RELATED TO LOADING SAVING READING SCHEDULE /////////////////////

      function saveReadingProgress() {
        let saveData = {};
        for (let i = 1; i < 366; i++) {
          let checkBoxId = "reading-check-" + i.toString();
          if ((checkBox = document.getElementById(checkBoxId) != null)) {
            let checkBox = document.getElementById(checkBoxId);
            console.log(checkBoxId, checkBox.checked);
            saveData[checkBoxId] = checkBox.checked;
          }
        }
        saveData["show-dates"] = showDates;
        console.log(JSON.stringify(saveData));
        saveStringToTextFile(JSON.stringify(saveData));
      }
      function saveStringToTextFile(
        str1,
        basename = "readingPlanProgress",
        fileType = ".json"
      ) {
        let filename = basename + fileType;
        let blobVersionOfText = new Blob([str1], {
          type: "text/plain",
        });
        let urlToBlob = window.URL.createObjectURL(blobVersionOfText);
        let downloadLink = document.createElement("a");
        downloadLink.style.display = "none";
        downloadLink.download = filename;
        downloadLink.href = urlToBlob;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        downloadLink.parentElement.removeChild(downloadLink);
      }

      function loadReadingProgress() {
        let fileContents = "";
        let inputTypeIsFile = document.createElement("input");
        inputTypeIsFile.type = "file";
        inputTypeIsFile.addEventListener("change", function () {
          let fileInput = inputTypeIsFile.files[0];
          let fileReader = new FileReader();
          fileReader.onload = function (fileLoadedEvent) {
            readingPlanData = JSON.parse(fileLoadedEvent.target.result);
            console.log(readingPlanData);
            for (readingDay in readingPlanData) {
              let checkBoxId = readingDay;
              if (document.getElementById(checkBoxId) != undefined) {
                document.getElementById(checkBoxId).checked =
                  readingPlanData[readingDay];
              }
            }
            if (readingPlanData["show-dates"] != undefined) {
              console.log(
                "not undefined, show-dates is " +
                  readingPlanData["show-dates"] +
                  "in json loaded in"
              );

              showDates = readingPlanData["show-dates"];

              if (showDates === true) {
                showReadingDates();
              } else {
                console.log("calling hideReadingDates");
                hideReadingDates();
              }
            }
          };
          fileReader.readAsText(fileInput, "UTF-8");
        });
        inputTypeIsFile.click();
      }
    </script>

    <script>
      //////////////////////////////////////////////////////////////
      //
      //  PROCESSING APP SELECTIONS, ATTACHING EVENTS TO BUTTONS
      //
      //////////////////////////////////////////////////////////////

      function initializeNavButtonsAndCloseApps() {
        let navButtons = document.getElementsByClassName("nav-button");
        for (let i = 0; i < navButtons.length; i++) {
          navButtons[i].addEventListener("click", (evt) => {
            processAppSelection(evt.target.id);
          });
        }
        let apps = document.getElementsByClassName("app");
        for (let i = 0; i < apps.length; i++) {
          apps[i].style.display = "none";
        }
      }

      function processAppSelection(id) {
        let myWidth =
          window.innerWidth ||
          document.documentElement.clientWidth ||
          document.body.clientWidth;
        console.log(myWidth);
        let appId = "app-" + id.split("btn-").join("");
        if (myWidth > 450) {
          let app = document.getElementById(appId);
          //console.log(app.style.display.toString());
          if (app.style.display === "none") {
            app.style.display = "block";
            document.getElementById(id).style.backgroundColor =
              "rgb(0,124,207)";
          } else {
            app.style.display = "none";
            document.getElementById(id).style.backgroundColor = "lightgrey";
          }
        } else {
          closeAllApps();
          let app = document.getElementById(appId);
          app.style.display = "block";
          document.getElementById(id).style.backgroundColor = "rgb(0,124,207)";
        }
        if (appId === "app-map") {
          setSizeOfPre();
        }
      }

      function closeAllApps() {
        let apps = document.getElementsByClassName("app");
        let appButtons = document.getElementsByClassName("nav-button");
        for (let i = 0; i < apps.length; i++) {
          apps[i].style.display = "none";
        }
        for (let i = 0; i < appButtons.length; i++) {
          appButtons[i].style.backgroundColor = "lightgrey";
        }
      }
      ////////////////////// SECTION ENDS /////////////////////////
    </script>

    <script>
      //////////////////////////////////////////////////////////////
      //
      //  MAKE READING PLAN TABLE AND NECESSARY FUNCTIONS
      //
      //////////////////////////////////////////////////////////////
      function makeReadingTable(readingPlan) {
        console.log(readingPlan);
        let readingTable = "<tr>";
        let now = new Date();
        let currentYear = now.getFullYear();
        for (let day in readingPlan) {
          let intDay = parseInt(day.split("Day").join("").trim());
          console.log(intDay);
          console.log(day, readingPlan[day]);
          let dayArray = readingPlan[day].split(",");
          readingTable +=
            "<td><ul><input type='checkbox' id='reading-check-" +
            intDay.toString() +
            "'><label><b>" +
            intDay.toString() +
            "</b></label></li>";
          readingTable +=
            "<li class='day-of-year' style='display:none'>" +
            getDateString(currentYear, intDay) +
            "</li>";

          for (readingChapter of dayArray) {
            readingTable +=
              "<li class='open-chapter color-hover'>" +
              readingChapter +
              "</li>";
          }
          readingTable += "</ul></td>";
          if (intDay % 7 === 0) {
            console.log("break week here");
            readingTable += "</tr><tr>";
          }
          if (intDay % 28 === 0) {
            console.log("break month here");
            readingTable +=
              "<td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr>";
          }
        }
        readingTable += "</tr>";
        return readingTable;
      }

      function getTodaysDate() {
        let now = new Date();
        let day = ("0" + now.getDate()).slice(-2);
        let month = ("0" + (now.getMonth() + 1)).slice(-2);
        let today = now.getFullYear() + "-" + month + "-" + day;
        return today;
      }

      function getDateString(year, dayInteger) {
        const d = new Date(year, 0, dayInteger);
        return (
          d.getFullYear().toString() +
          "-" +
          ("0" + (d.getMonth() + 1).toString()).slice(-2) +
          "-" +
          ("0" + d.getDate().toString()).slice(-2)
        );
      }

      function toggleReadingDates() {
        let readingDates = document.getElementsByClassName("day-of-year");
        console.log(readingDates);
        let today = getTodaysDate();

        for (let i = 0; i < readingDates.length; i++) {
          if (readingDates[i].style.display === "none") {
            readingDates[i].style.display = "list-item";
            if (readingDates[i].innerText === today) {
              //console.log("today found! at", today);
              readingDates[i].style.backgroundColor = "orange";
            }
            showDates = true;
          } else {
            readingDates[i].style.display = "none";
            showDates = false;
          }
        }
      }

      function showReadingDates() {
        let today = getTodaysDate();
        let readingDates = document.getElementsByClassName("day-of-year");
        for (let i = 0; i < readingDates.length; i++) {
          readingDates[i].style.display = "list-item";
          if (readingDates[i].innerText === today) {
            //console.log("today found! at", today);
            readingDates[i].style.backgroundColor = "orange";
          }
        }
        showDates = true;
      }
      function hideReadingDates() {
        let readingDates = document.getElementsByClassName("day-of-year");
        for (let i = 0; i < readingDates.length; i++) {
          readingDates[i].style.display = "none";
        }
        showDates = false;
      }

      //////////////////////////////////////////////////////////////
      //
      //                SECTION ENDS
      //
      //////////////////////////////////////////////////////////////
    </script>

    <script>
      ///////PROCESSING BIBLE AND ADDING CLASSES FOR EVENT LISTENERS //////
      /////// IN VERSES, CHAPTERS AND WORDS ///////////////////////
      //////////////// FOR WHOLE BIBLE AT LOAD ///////////////////////

      function makeHTMLChapterBible(theChapterBible) {
        //return theChapterBible;
        let tempStr = JSON.stringify(theChapterBible);
        tempStr = tempStr.split("HEADINGSTART").join("<h2>");
        tempStr = tempStr.split("HEADINGEND").join("</h2>");
        tempStr = tempStr.split("HEADINGEND").join("</h2>");
        tempStr = tempStr.split("PARAGRAPHSTARTS").join("<p>");
        tempStr = tempStr.split("PARAGRAPHENDS").join("</p>");
        tempStr = tempStr.split("VERSESTART").join("<sup>");
        tempStr = tempStr.split("VERSEEND").join("</sup>");
        tempStr = tempStr
          .split("FOUNDWORDSTART")
          .join("<span class='color-hover found-bible-word'>");
        tempStr = tempStr.split("FOUNDWORDEND").join("</span>");
        return JSON.parse(tempStr);
      }

      function makeEastons(eastons) {
        //return eastons;
        let tempStr = JSON.stringify(eastons);
        tempStr = tempStr
          .split("VERSEREFSTART")
          .join("<span class='open-verse color-hover'>");
        tempStr = tempStr.split("VERSEREFEND").join("</span>");
        tempStr = tempStr
          .split("CHAPTERREFSTART")
          .join("<span class='open-chapter color-hover'>");
        tempStr = tempStr.split("CHAPTERREFEND").join("</span>");
        return JSON.parse(tempStr);
      }

      function parseString(str) {
        str = str.split("HEADINGSTART").join("<h2>");
        str = str.split("HEADINGEND").join("</h2>");
        str = str.split("HEADINGEND").join("</h2>");
        str = str.split("PARAGRAPHSTARTS").join("<p>");
        str = str.split("PARAGRAPHENDS").join("</p>");
        str = str.split("VERSESTART").join("<sup>");
        str = str.split("VERSEEND").join("</sup>");
        str = str
          .split("FOUNDWORDSTART")
          .join("<span class='color-hover found-bible-word'>");
        str = str.split("FOUNDWORDEND").join("</span>");
        str = str
          .split("VERSEREFSTART")
          .join("<span class='open-verse color-hover'>");
        str = str.split("VERSEREFEND").join("</span>");
        str = str
          .split("CHAPTERREFSTART")
          .join("<span class='open-chapter color-hover'>");
        str = str.split("CHAPTERREFEND").join("</span>");

        //pulpit commentary
        str = str
          .split("PULPITSTART")
          .join("<h2 class='pulpit-commentary-heading'>");
        str = str.split("PULPITEND").join("</h2>");
        str = str.split("NEWLINE").join("<br>");
        str = str.split("PULPITVERSEBEGIN").join("<h4><i>");
        str = str.split("PULPITVERSEFINISH").join("</i></h4>");
        str = str
          .split("VERSETITLESTART")
          .join("<br><h3><span class='open-verse color-hover'>"); //<span class='open-verse color-hover'>
        str = str.split("VERSETITLEEND").join("</span></h3>");
        //str = str.split("<br><br>").join("<br>");

        //VERSESTART and VERSEEND made into <sup></sup> already
        //
        return str;
      }

      ////////////////////////////////////////////////////////////////
    </script>

    <script>
      ///////////////POPULATING THE SELECT OPTIONS OF THE BIBLE CHAPTER SELECTIONS //////////////////
      function buildChapterSearchOptions() {
        //bookChapterKeys global bibleBCSelction also global
        let str = "";
        for (let i = 0; i < bookChapterKeys.length; i++) {
          str += "<option value='" + bookChapterKeys[i] + "' />";
        }
        bibleChaptersDatalist.innerHTML = str;
      }

      function buildCommentarySearchOptions() {
        //bookChapterKeys global bibleBCSelction also global
        let str = "";
        for (let i = 0; i < bookChapterKeys.length; i++) {
          str += "<option value='" + bookChapterKeys[i] + "' />";
        }
        commentaryChaptersDatalist.innerHTML = str;
      }

      /////// TAKES CURRENT BIBLE SELECTION AND LOADS THE BIBLE PASSAGE
      /////// THEN ATTACHES EVENT LISTENERS TO SPANS OF FOUND WORDS

      function showBibleSelection() {
        //***************** AJAX function ********************

        if (local === true) {
          //if local do this
          bibleResult.innerHTML = parseString(
            theChapterBible[chapterSearchBox.value]
          );
          addEventListenersToFoundBibleWords();
          let myWidth =
            window.innerWidth ||
            document.documentElement.clientWidth ||
            document.body.clientWidth;
          if (myWidth < 450) {
            processAppSelection("btn-bible");
          }
        } else {
          let osisRef = chapterSearchBox.value;
          getBibleChapterRemote(osisRef);
        }
      }

      function showCommentarySelection() {
        //***************** AJAX function ********************

        if (local === true) {
          //if local do this
          commentaryResult.innerHTML = parseString(
            pulpit[commentarySearchBox.value]
          );
          addEventListenersToOpenVerses();
          //addEventListenersToFoundBibleWords();
          let myWidth =
            window.innerWidth ||
            document.documentElement.clientWidth ||
            document.body.clientWidth;
          if (myWidth < 450) {
            processAppSelection("btn-commentary");
          }
        } else {
          let osisRef = commentarySearchBox.value;
          getCommentaryChapterRemote(osisRef);
        }
      }

      /////// GIVEN CHAPTER REFERENCE SET THE CHAPTER SEARCH BOX TO REFERENCE
      /////// ADD EVENT LISTENERS TO THE BIBLE CHAPTER AFTER LOADING
      function selectBibleChapter(osisRef) {
        chapterSearchBox.value = osisRef;
        showBibleSelection();
      }

      ////// SIMPLY PARSES FULL BIBLE VERSE TO CHAPTER 0NLY AND CALLS
      ////// selectBibleChapter
      function selectBibleVerse(osisRef) {
        osisRefArray = osisRef.split(".");
        osisRefArray.pop();
        osisRef = osisRefArray.join(".");
        selectBibleChapter(osisRef);
      }

      /////// FUNCTIONS TO ADD EVENT LISTENERS TO VERSES, CHAPTERS, DICTIONARY
      /////// AND LOCATION SPANS

      function addEventListenersToOpenVerses() {
        let openVerses = document.getElementsByClassName("open-verse");
        for (let i = 0; i < openVerses.length; i++) {
          openVerses[i].addEventListener("click", (evt) => {
            selectBibleVerse(evt.target.innerText);
          });
        }
      }

      function addEventListenersToOpenChapters() {
        let openChapters = document.getElementsByClassName("open-chapter");
        for (let i = 0; i < openChapters.length; i++) {
          openChapters[i].addEventListener("click", (evt) => {
            selectBibleChapter(evt.target.innerText);
          });
        }
      }

      function addEventListenersToOpenDictionaryEntries() {
        //doesn't use word, but uses subentry under word
        let openDictionaryEntries = document.getElementsByClassName(
          "open-dictionary-entry"
        );
        for (let i = 0; i < openDictionaryEntries.length; i++) {
          openDictionaryEntries[i].addEventListener("click", (evt) => {
            openDictionaryEntry(
              getWordFromEntry(evt.target.innerText),
              evt.target.innerText
            );
          });
        }
      }

      function getWordFromEntry(dictLookup) {
        //************* NEEDS A PREPROCESSED ARRAY HERE OR SIMPLY TEST AND SPLICE ********************
        let tempArr = dictLookup.split(" ");
        if (tempArr[tempArr.length - 1] === NaN) {
          console.log("word ", dictLookup);
          return dictLookup;
        } else {
          tempArr.pop();
          console.log("word", tempArr.join(" "));
          return tempArr.join(" ");
        }
      }

      function addEventListenersToFoundBibleWords() {
        let foundBibleWords =
          document.getElementsByClassName("found-bible-word");
        for (let i = 0; i < foundBibleWords.length; i++) {
          foundBibleWords[i].addEventListener("click", (evt) => {
            openDictionaryEntry(evt.target.innerText);
          });
        }
      }

      function addEventListenersToDictionaryLocations() {
        let dictionaryLocations = document.getElementsByClassName(
          "dictionary-location"
        );
        for (let i = 0; i < dictionaryLocations.length; i++) {
          dictionaryLocations[i].addEventListener("click", (evt) => {
            let myWidth =
              window.innerWidth ||
              document.documentElement.clientWidth ||
              document.body.clientWidth;
            if (myWidth < 450) {
              //document.getElementById('btn-map').click();
              processAppSelection("btn-map");
            } else {
              document.getElementById("app-map").style.display = "block";
              document.getElementById("btn-map").style.backgroundColor =
                "rgb(0,124,207)";
            }
            setSizeOfPre();
            document.getElementById("map-location").innerHTML =
              evt.target.innerText;
            document.getElementById("coordinates-label").innerHTML =
              dictionarySearchBox.value;
            plotOnMap(evt.target.innerText);
          });
        }
      }

      function openGoogleMap() {
        let location = document.getElementById("map-location").innerText;
        if (location.length > 3) {
          //string is not empty contains at least 3 characters
          window.open("http://maps.google.com/maps?q=" + location);
        }
      }

      function plotOnMap(location) {
        if (document.getElementById("app-map").style.display === "none") {
          //do nothing
        } else {
          let labelText = dictionarySearchBox.value;

          let latitude = parseFloat(location.split(",")[0]);
          let longitude = parseFloat(location.split(",")[1]);
          let x = convertLongitude(longitude);
          let y = convertLatitude(latitude);
          console.log(latitude, longitude);
          console.log(x, y);

          let bullsEye = document.createElement("span");
          bullsEye.classList.add("bulls-eye");
          bullsEye.style.position = "absolute";
          bullsEye.style.left = x.toString() + "px";
          bullsEye.style.top = y.toString() + "px";
          //bullsEye.innerHTML = "o";
          bullsEye.innerHTML = "o<sub>" + labelText + "</sub>";
          mapContainer.appendChild(bullsEye);
        }
      }

      function convertLongitude(longitude) {
        //the map is about 320px wide //get computed width
        //longitude starts at 33.5 and ends at 36.5
        //let width=320;
        //width=parseFloat(asciiMap.width.slice(0,-2));
        let width = asciiMap.offsetWidth;
        console.log("calculated sscii map width", width);
        let x = (width * longitude - width * 33.5) / (36.5 - 33.5);
        console.log(x);
        return x;
      }

      function convertLatitude(latitude) {
        //the map is about 620px high
        //latitude starts at 34 and goes to 29
        //let height=620;
        //height=parseFloat(asciiMap.height.slice(0,-2));
        let height = asciiMap.offsetHeight;
        console.log("calculated ascii map height", height);
        let slope = height / (29 - 34);
        let y = slope * latitude - slope * 34;
        console.log(y);
        return y;
      }

      function clearBullsEyes() {
        let bullsEyes = document.getElementsByClassName("bulls-eye");
        for (let i = bullsEyes.length - 1; i >= 0; i--) {
          bullsEyes[i].remove();
        }
      }

      function clearBackgroundLocations() {
        document.getElementById("map-location").innerHTML = "";
        document.getElementById("coordinates-label").innerHTML = "";

        let existingLocations = document.getElementsByClassName(
          "background-location"
        );
        let existingLocationLabels = document.getElementsByClassName(
          "background-location-label"
        );

        for (let i = existingLocations.length - 1; i >= 0; i--) {
          existingLocations[i].remove();
        }

        for (let i = existingLocationLabels.length - 1; i >= 0; i--) {
          existingLocationLabels[i].remove();
        }

        document.getElementById("map-name").innerHTML = "&nbsp;";

        let mapButtons = document.getElementsByClassName("btn-select-map");
        for (let i = 0; i < mapButtons.length; i++) {
          mapButtons[i].style.backgroundColor = "lightgrey";
        }
      }

      function setSizeOfPre() {
        asciiMap.style.fontSize = "20px";
        let floatFontSize = 20;
        let pixelWidth = 320; //target width
        console.log(asciiMap.offsetWidth); //the width of ascii map
        while (asciiMap.offsetWidth >= pixelWidth) {
          //map to big, above target
          floatFontSize = parseFloat(asciiMap.style.fontSize.slice(0, -2));
          console.log(asciiMap.offsetWidth, floatFontSize);
          floatFontSize = floatFontSize - 0.5;
          asciiMap.style.fontSize = floatFontSize + "px"; //reduce map font size
          if (floatFontSize <= 0.5) {
            //minimum font size;
            break;
          }
        }
      }

      addEventListenersToOpenVerses();
      addEventListenersToOpenChapters();
      addEventListenersToOpenDictionaryEntries();
      addEventListenersToFoundBibleWords();
      addEventListenersToDictionaryLocations();
    </script>
    <!--DICTIONARY STUFF HERE-->

    <script>
      /////////////////////////////////////////////////////////////////////
      //
      /////////////////// DICTIONARY ENTRY OPENING ETC ////////////////////
      //
      ///////////////////////////////////////////////////////////////////
      function buildDictionarySearchOptions() {
        if (local === true) {
          _buildDictionarySearchOptionsLocal();
        } else {
          _buildDictionarySearchOptionsRemote();
        }
      }

      function _buildDictionarySearchOptionsLocal() {
        //***************** NEEDS EASTONS WORD INDEX ARRAY ********************
        let str = "";
        for (let i = 0; i < eastons.length; i++) {
          str += "<option value='" + eastons[i]["word"] + "' />";
        }
        dictionaryDataList.innerHTML = str;
        //   openDictionaryEntry("Jesus", "Jesus 2");
      }

      ////////////////////////////////////////////
      //    HANDLING THE OPENING OF A WORD AND ENTRY
      //
      function openDictionaryEntry(word, entry) {
        //opens the word in dictionary and subentry if given
        //_selectDictionaryWord(word); //setting the index correctly in the select element
        console.log("entry", entry);

        word = word.charAt(0).toUpperCase() + word.slice(1); //capitalizes first letter
        dictionarySearchBox.value = word;

        console.log(word);

        //showDictionarySelection(); //builds the dictionary innerHTML content and adds event listeners
        //takes the word not subword from the selection element
        //note will be closed unless there is only one definition then it is opened
        //let selectedWord = dictionarySelection.options[dictionarySelection.selectedIndex].text;

        let index = getIndexOfWord(word);

        if (local === true) {
          let resultEntries = JSON.parse(
            parseString(JSON.stringify(eastons[index]["entries"]))
          );
          _buildDictionaryResult(resultEntries, entry);
        } else {
          getDictionaryWordDataRemote(index, entry);
        }
      }

      function showDictionarySelection() {
        let word = dictionarySearchBox.value.trim();
        openDictionaryEntry(word);
      }

      function closeWordEntries() {
        let wordEntries = document.getElementsByClassName("word-entry");
        for (let i = 0; i < wordEntries.length; i++) {
          closeSiblings(wordEntries[i].id);
        }
      }

      function getIndexOfWord(word) {
        ////NEEDS ARRAY HERE

        if (local === true) {
          for (let i = 0; i < eastons.length; i++) {
            if (eastons[i]["word"] === word) {
              //console.log("found at",i);
              return i;
            }
          }
          return -1;
        } else {
          for (let i = 0; i < wordList.length; i++) {
            if (wordList[i] === word) {
              //console.log("found at",i);
              return i;
            }
          }
          return -1;
        }
      }

      ////////////////////////////////////////////
      ////////// NESTED MENU STUFF ////////////////
      ///////////////////////////////////////
      function toggleNest(menu) {
        let siblings = menu.parentElement.children;
        for (let sibling of siblings) {
          if (sibling === menu) {
            //alert("found self!");
          } else {
            if (sibling.style.display === "none") {
              sibling.style.display = "inherit";
            } else {
              sibling.style.display = "none";
            }
          }
        }
      }

      function addEventListenersToNestedMenus() {
        let nestedMenues = document.getElementsByClassName("nested-menu");
        for (let nestedmenu of nestedMenues) {
          nestedmenu.addEventListener("click", (evt) => {
            toggleNest(evt.target);
          });
        }
      }

      function openSiblings(id) {
        let menu = document.getElementById(id);
        let siblings = menu.parentElement.children;
        for (let sibling of siblings) {
          if (sibling === menu) {
          } else {
            sibling.style.display = "inherit";
          }
        }
      }

      function closeSiblings(id) {
        let menu = document.getElementById(id);
        let siblings = menu.parentElement.children;
        for (let sibling of siblings) {
          if (sibling === menu) {
            //do nothing
          } else {
            sibling.style.display = "none";
          }
        }
      }
      ///////////////////////NESTED MENU STUFF ENDS///////////////
    </script>
    <script>
      function showVersion(local) {
        if (local === true) {
          document.getElementById("btn-download").style.display = "none";
          document.getElementById("version-type").innerHTML = "offline version";
        } else {
          document.getElementById("version-type").innerHTML = "online version";
        }
      }

      function plotBackgroundLocation(location, locationName) {
        let latitude = parseFloat(location.split(",")[0]);
        let longitude = parseFloat(location.split(",")[1]);
        let x = convertLongitude(longitude);
        let y = convertLatitude(latitude);
        let backgroundLocation = document.createElement("span");
        backgroundLocation.classList.add("background-location");
        backgroundLocation.style.position = "absolute";
        backgroundLocation.style.left = x.toString() + "px";
        backgroundLocation.style.top = y.toString() + "px";
        backgroundLocation.innerHTML = "o<sub>" + locationName + "</sub>";

        //   backgroundLocationLabel = document.createElement("span");
        //   backgroundLocationLabel.classList.add("background-location-label");
        //   backgroundLocationLabel.style.position = "absolute";
        //   backgroundLocationLabel.style.left = (x + 10).toString() + "px";
        //   backgroundLocationLabel.style.top = y.toString() + "px";
        //   backgroundLocationLabel.innerHTML = locationName;

        mapContainer.appendChild(backgroundLocation);
        //   mapContainer.appendChild(backgroundLocationLabel);
      }

      function plotBackgroundMapLocations(id) {
        let existingLocations = document.getElementsByClassName(
          "background-location"
        );
        // let existingLocationLabels = document.getElementsByClassName("background-location-label");

        for (let i = existingLocations.length - 1; i >= 0; i--) {
          existingLocations[i].remove();
        }

        // for (let i = existingLocationLabels.length - 1; i >= 0; i--) {
        //   existingLocationLabels[i].remove();
        // }

        if (id === "map-Abraham") {
          plotBackgroundLocation(
            "31.69352950368834,34.84388288576839",
            "Canaan"
          );
          plotBackgroundLocation("30.9625,46.103056", "Ur");
          plotBackgroundLocation("36.86,39.03139", "Haran");
          plotBackgroundLocation("33.511612,36.309102", "Damascus");
          plotBackgroundLocation("32.22111,35.25444", "Shechem");
          plotBackgroundLocation("31.93053921,35.22103275", "Bethel");
          plotBackgroundLocation("33.24856,35.65252", "Dan");
          // plotBackgroundLocation("33.5,36.466667","Hobah");
          plotBackgroundLocation("31.777444,35.234935", "Salem");
          plotBackgroundLocation("31.38176,34.60698", "Gerar");
          plotBackgroundLocation("31.245,34.84068", "Beersheba");
          plotBackgroundLocation("31.032047,33.854957", "Egypt");
        } else if (id === "map-Moses") {
          plotBackgroundLocation("29.5,34", "Sinai");
          plotBackgroundLocation("31.69352950368834,34.84388288576839", "Zin");
          plotBackgroundLocation("29.306194,32.980924", "Elim");
          plotBackgroundLocation("30.998062,35.498547", "Beer");
          plotBackgroundLocation("29.35,32.933333", "Marah");
          plotBackgroundLocation("19.0,39.5", "Red Sea");
          plotBackgroundLocation("28.838778,33.420573", "Wilderness of Sin");
        } else if (id === "map-12 Tribes") {
          plotBackgroundLocation("32.559061,35.246206", "Kedesh");
          plotBackgroundLocation("32.80007553,35.9373013", "Golan");
          plotBackgroundLocation("32.049953,35.733402", "Ramoth");
          plotBackgroundLocation("32.51613741,36.48829076", "Bezer");
          plotBackgroundLocation("31.524354,35.108539", "Hebron");
          plotBackgroundLocation("32.22111,35.25444", "Shechem");
          plotBackgroundLocation("33.511612,36.309102", "Damascus");
          plotBackgroundLocation("31.95522,35.94503", "Ammon");
          plotBackgroundLocation("31.777444,35.234935", "Jerusalem");
          plotBackgroundLocation("32.280231,35.197929", "Samaria");
        } else if (id === "map-Divided Kingdoms") {
          plotBackgroundLocation("32.22111,35.25444", "Shechem");
          plotBackgroundLocation("32.280231,35.197929", "Samaria");
          plotBackgroundLocation("31.777444,35.234935", "Jerusalem");
          plotBackgroundLocation("31.524354,35.108539", "Hebron");
          plotBackgroundLocation("31.503959,34.46203", "Gaza");
          plotBackgroundLocation("31.38176,34.60698", "Gerar");
          plotBackgroundLocation("33.511612,36.309102", "Damascus");
          plotBackgroundLocation("32.502074,35.50196", "Jezreel");
        } else if (id === "map-Jesus") {
          plotBackgroundLocation("31.70431,35.20746", "Bethlehem");
          plotBackgroundLocation("33.511612,36.309102", "Damascus");
          plotBackgroundLocation("41.01316,24.28409", "Phillipi");
          plotBackgroundLocation("32.701029,35.300148", "Nazareth");
          plotBackgroundLocation("32.502074,35.50196", "Jezreel");
          plotBackgroundLocation("32.280231,35.197929", "Samaria");
          plotBackgroundLocation("32.8138046,35.590564", "Sea Galilee");
          plotBackgroundLocation("31.577850349494952,35.52394311", "Dead Sea");
          plotBackgroundLocation("31.79819,35.80986", "Mt. Ebal");
          plotBackgroundLocation("31.777444,35.234935", "Jerusalem");
          plotBackgroundLocation("31.524354,35.108539", "Hebron");
          plotBackgroundLocation("31.422876,35.132952", "Carmel");
          plotBackgroundLocation("31.503959,34.46203", "Gaza");
          plotBackgroundLocation("31.93053921,35.22103275", "Bethel");
        }
      }
    </script>
    <!-- <script src="finalDatabase.js"></script>
    <script src="NASBChapterBible.js"></script>
    <script src="pulpit.js"></script> -->
    <script>
      let local = false;
      showVersion(local);
      initializeNavButtonsAndCloseApps();
      let showDates = true;
      window.onbeforeunload = askConfirm;

      let bibleBCSelection = document.getElementById("bible-bc-selection");
      let bibleResult = document.getElementById("bible-result");
      let mapContainer = document.getElementById("map-container");
      let asciiMap = document.getElementById("ascii-map");
      let dictionarySelection = document.getElementById("dictionary-selection");
      let dictionaryResult = document.getElementById("dictionary-result");

      let dictionaryDataList = document.getElementById("dictionary-words");
      let dictionarySearchBox = document.getElementById(
        "dictionary-search-box"
      );
      let chapterSearchBox = document.getElementById("chapter-search-box");
      let bibleChaptersDatalist = document.getElementById(
        "bible-chapters-datalist"
      );

      let commentarySearchBox = document.getElementById(
        "commentary-search-box"
      );
      let commentaryChaptersDatalist = document.getElementById(
        "commentary-chapters-datalist"
      );
      let commentaryResult = document.getElementById("commentary-result");

      buildDictionarySearchOptions();

      buildChapterSearchOptions();
      buildCommentarySearchOptions();
      //   theChapterBible = makeHTMLChapterBible(theChapterBible);
      //   eastons = makeEastons(eastons);
      document.getElementById("reading-plan-table").innerHTML =
        makeReadingTable(readingPlan);
      toggleReadingDates();
      addEventListenersToNestedMenus();

      addEventListenersToOpenChapters(); //for reading plan

      setSizeOfPre();

      closeAllApps();
      selectBibleVerse("Gen.1.1");
      document.getElementById("app-bible").style.display = "block";
      document.getElementById("btn-bible").style.backgroundColor =
        "rgb(0,124,207)";
      document.getElementById("ascii-map").innerText = baseMap;
    </script>
  </body>
</html>
